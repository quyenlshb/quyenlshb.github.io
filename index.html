<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám t·ª´ v·ª±ng ti·∫øng Nh·∫≠t</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f4f8;
            color: #2c3e50;
            flex-direction: column;
            padding: 20px;
        }

        .card-container {
            width: 90%;
            max-width: 600px;
            text-align: center;
            padding: 30px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .japanese-word {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #34495e;
            transition: opacity 0.5s ease-in-out;
        }

        .romaji {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .options-container {
            display: grid;
            gap: 15px;
            grid-template-columns: 1fr;
        }

        .option-button {
            padding: 15px 25px;
            font-size: 1.1em;
            font-weight: 700;
            color: #2c3e50;
            background-color: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            text-align: left;
        }

        .option-button:hover {
            background-color: #d8e1e7;
        }

        .option-button:active {
            transform: translateY(1px);
        }

        .option-button.correct {
            background-color: #27ae60;
            color: white;
            border-color: #2ecc71;
        }

        .option-button.incorrect {
            background-color: #e74c3c;
            color: white;
            border-color: #c0392b;
        }

        .result-message {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: 700;
            color: #3498db;
            min-height: 1.5em;
        }

        .navigation-panel {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 600px;
        }

        .nav-button {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 700;
            color: white;
            background-color: #3498db;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        .nav-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .nav-button:active {
            transform: translateY(0);
        }
        
        .hidden {
            display: none;
        }

        .counter {
            font-size: 1em;
            color: #7f8c8d;
        }

        /* Home Page specific styles */
        .home-page .option-button {
            display: block;
            width: 100%;
            text-align: center;
            margin-bottom: 15px;
        }

        .home-page h1 {
            font-size: 2.5em;
        }
        
        .home-page p {
            font-size: 1.2em;
            margin-bottom: 25px;
        }

        /* Custom Quiz Input styles */
        .custom-quiz-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .custom-quiz-input-container input {
            flex-grow: 1;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            text-align: center;
        }
        .custom-quiz-input-container .option-button {
            width: auto; /* Reset width for flex container */
        }


        /* Add Word Page styles */
        #add-word-page {
            text-align: left;
        }
        #add-word-page input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
        }
        #add-word-page label {
            font-weight: 700;
            margin-bottom: 5px;
            display: block;
        }
        #add-word-page #add-button {
            width: 100%;
            background-color: #2ecc71;
            color: white;
        }

        .score-container {
            margin-top: 10px;
            text-align: right;
            font-size: 1em;
            font-weight: 700;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        .score-item:last-child {
            border-bottom: none;
        }


        /* Responsive design */
        @media (min-width: 600px) {
            .options-container {
                grid-template-columns: 1fr 1fr;
            }
            .home-page .options-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <!-- Trang ch·ªß -->
    <div id="home-page" class="card-container home-page">
        <h1>Ch√†o m·ª´ng ƒë·∫øn v·ªõi web c·ªßa Quy·ªÅn</h1>
        <p>Ch·ªçn s·ªë l∆∞·ª£ng t·ª´ b·∫°n mu·ªën h·ªçc trong m·ªói l·∫ßn tr·∫Øc nghi·ªám.</p>
        <div class="options-container">
            <button class="option-button" data-quiz-size="15">H·ªçc 15 t·ª´</button>
            <button class="option-button" data-quiz-size="20">H·ªçc 20 t·ª´</button>
            <div class="custom-quiz-input-container">
                <input type="number" id="custom-quiz-input" placeholder="S·ªë t·ª´">
                <button class="nav-button" id="start-custom-quiz">B·∫Øt ƒë·∫ßu</button>
            </div>
            <button class="option-button" id="add-word-option">Th√™m t·ª´ m·ªõi</button>
        </div>
    </div>

    <!-- Trang th√™m t·ª´ m·ªõi -->
    <div id="add-word-page" class="card-container hidden">
        <h2>Th√™m t·ª´ v·ª±ng m·ªõi</h2>
        <label for="japanese-input">T·ª´ ti·∫øng Nh·∫≠t:</label>
        <input type="text" id="japanese-input" placeholder="Nh·∫≠p t·ª´ ti·∫øng Nh·∫≠t (v√≠ d·ª•: „Åì„Çì„Å´„Å°„ÅØ)">
        <label for="romaji-input">Romaji:</label>
        <input type="text" id="romaji-input" placeholder="Nh·∫≠p romaji (v√≠ d·ª•: konnichiwa)">
        <label for="vietnamese-input">Nghƒ©a ti·∫øng Vi·ªát:</label>
        <input type="text" id="vietnamese-input" placeholder="Nh·∫≠p nghƒ©a ti·∫øng Vi·ªát (v√≠ d·ª•: Xin ch√†o)">
        <button class="nav-button" id="add-button">Th√™m t·ª´</button>
        <div id="add-message" style="margin-top: 15px; color: #2ecc71;"></div>
    </div>

    <!-- Trang tr·∫Øc nghi·ªám -->
    <div id="quiz-page" class="card-container hidden">
        <h1 class="japanese-word" id="japanese-word"></h1>
        <p class="romaji" id="romaji"></p>
        
        <div class="options-container" id="options-container">
            <!-- Buttons will be generated by JavaScript -->
        </div>

        <p class="result-message" id="result-message"></p>
        
        <div id="word-scores-breakdown" class="hidden">
            <h3>Chi ti·∫øt ƒëi·ªÉm s·ªë:</h3>
        </div>
    </div>

    <div id="quiz-navigation" class="navigation-panel hidden">
        <button id="back-button" class="nav-button">Trang ch·ªß</button>
        <div style="text-align: center;">
            <span class="counter" id="counter"></span>
            <div class="score-container">T·ªïng ƒëi·ªÉm: <span id="score-display">0</span></div>
        </div>
        <button id="next-button" class="nav-button hidden">Ti·∫øp theo</button>
    </div>

    <script>
        // Danh s√°ch 50 t·ª´ ti·∫øng Nh·∫≠t ban ƒë·∫ßu
        const initialVocabulary = [
            { japanese: '„Åì„Çì„Å´„Å°„ÅØ', romaji: 'konnichiwa', vietnamese: 'Xin ch√†o' },
            { japanese: '„ÅÇ„Çä„Åå„Å®„ÅÜ', romaji: 'arigatou', vietnamese: 'C·∫£m ∆°n' },
            { japanese: '„Åô„Åø„Åæ„Åõ„Çì', romaji: 'sumimasen', vietnamese: 'Xin l·ªói / Xin ph√©p' },
            { japanese: '„ÅØ„ÅÑ', romaji: 'hai', vietnamese: 'V√¢ng / C√≥' },
            { japanese: '„ÅÑ„ÅÑ„Åà', romaji: 'iie', vietnamese: 'Kh√¥ng' },
            { japanese: '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', romaji: 'ohayou gozaimasu', vietnamese: 'Ch√†o bu·ªïi s√°ng' },
            { japanese: '„Åì„Çì„Å∞„Çì„ÅØ', romaji: 'konbanwa', vietnamese: 'Ch√†o bu·ªïi t·ªëi' },
            { japanese: '„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ', romaji: 'oyasuminasai', vietnamese: 'Ch√∫c ng·ªß ngon' },
            { japanese: '„Åï„Çà„ÅÜ„Å™„Çâ', romaji: 'sayounara', vietnamese: 'T·∫°m bi·ªát' },
            { japanese: '„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶', romaji: 'hajimemashite', vietnamese: 'R·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n' },
            { japanese: '„Åä„Å≠„Åå„ÅÑ„Åó„Åæ„Åô', romaji: 'onegaishimasu', vietnamese: 'L√†m ∆°n / Xin vui l√≤ng' },
            { japanese: '„ÅÑ„Åü„Å†„Åç„Åæ„Åô', romaji: 'itadakimasu', vietnamese: 'M·ªùi ƒÉn c∆°m' },
            { japanese: '„Åî„Å°„Åù„ÅÜ„Åï„Åæ', romaji: 'gochisousama', vietnamese: 'C·∫£m ∆°n v√¨ b·ªØa ƒÉn' },
            { japanese: '„Åä„ÅÑ„Åó„ÅÑ', romaji: 'oishii', vietnamese: 'Ngon' },
            { japanese: '„Åã„Çè„ÅÑ„ÅÑ', romaji: 'kawaii', vietnamese: 'D·ªÖ th∆∞∆°ng' },
            { japanese: '„Åô„Åî„ÅÑ', romaji: 'sugoi', vietnamese: 'Tuy·ªát v·ªùi / Kinh ng·∫°c' },
            { japanese: '„Åå„Çì„Å∞„Å£„Å¶', romaji: 'ganbatte', vietnamese: 'C·ªë l√™n' },
            { japanese: '„Åä„Åí„Çì„Åç„Åß„Åô„Åã', romaji: 'ogenki desu ka', vietnamese: 'B·∫°n c√≥ kh·ªèe kh√¥ng?' },
            { japanese: '„Çè„Åü„Åó', romaji: 'watashi', vietnamese: 'T√¥i' },
            { japanese: '„ÅÇ„Å™„Åü', romaji: 'anata', vietnamese: 'B·∫°n' },
            { japanese: '„Åì„Çå', romaji: 'kore', vietnamese: 'C√°i n√†y' },
            { japanese: '„Åù„Çå', romaji: 'sore', vietnamese: 'C√°i ƒë√≥' },
            { japanese: '„ÅÇ„Çå', romaji: 'are', vietnamese: 'C√°i kia' },
            { japanese: '„Å©„Åì', romaji: 'doko', vietnamese: '·ªû ƒë√¢u' },
            { japanese: '„ÅÑ„Å§', romaji: 'itsu', vietnamese: 'Khi n√†o' },
            { japanese: '„ÅÑ„Åè„Çâ', romaji: 'ikura', vietnamese: 'Bao nhi√™u ti·ªÅn' },
            { japanese: '„Å™„Çì', romaji: 'nan', vietnamese: 'C√°i g√¨' },
            { japanese: '„Å†„Çå', romaji: 'dare', vietnamese: 'Ai' },
            { japanese: '„Å©„ÅÜ„Åó„Å¶', romaji: 'doushite', vietnamese: 'T·∫°i sao' },
            { japanese: '„Å©„ÅÜ„ÇÇ', romaji: 'doumo', vietnamese: 'C·∫£m ∆°n / Ch√†o' },
            { japanese: '„Å©„ÅÜ„Åû', romaji: 'douzo', vietnamese: 'Xin m·ªùi' },
            { japanese: '„Åä„ÅØ„Çà„ÅÜ', romaji: 'ohayou', vietnamese: 'Ch√†o bu·ªïi s√°ng (th√¢n m·∫≠t)' },
            { japanese: '„Åí„Çì„Åç', romaji: 'genki', vietnamese: 'Kh·ªèe' },
            { japanese: '„Åó„Åî„Å®', romaji: 'shigoto', vietnamese: 'C√¥ng vi·ªác' },
            { japanese: '„Åå„Å£„Åì„ÅÜ', romaji: 'gakkou', vietnamese: 'Tr∆∞·ªùng h·ªçc' },
            { japanese: '„Åä„Åø„ÇÑ„Åí', romaji: 'omiyage', vietnamese: 'Qu√† l∆∞u ni·ªám' },
            { japanese: '„Åä„Åã„Åó', romaji: 'okashi', vietnamese: 'K·∫πo, b√°nh' },
            { japanese: '„Åä„Åï„Åë', romaji: 'osake', vietnamese: 'R∆∞·ª£u sake' },
            { japanese: '„Åî„ÅØ„Çì', romaji: 'gohan', vietnamese: 'C∆°m' },
            { japanese: '„Åø„Åö', romaji: 'mizu', vietnamese: 'N∆∞·ªõc' },
            { japanese: '„Åä„Å°„ÇÉ', romaji: 'ocha', vietnamese: 'Tr√†' },
            { japanese: '„Å´„Åª„Çì„Åî', romaji: 'nihongo', vietnamese: 'Ti·∫øng Nh·∫≠t' },
            { japanese: '„Åà„ÅÑ„Åî', romaji: 'eigo', vietnamese: 'Ti·∫øng Anh' },
            { japanese: '„Çè„Åü„Åó„ÅØ', romaji: 'watashi wa', vietnamese: 'T√¥i l√†...' },
            { japanese: '„Äú„Åß„Åô', romaji: 'desu', vietnamese: 'L√† (tr·ª£ ƒë·ªông t·ª´)' },
            { japanese: '„ÅØ„ÅÑ„ÄÅ„Åù„ÅÜ„Åß„Åô', romaji: 'hai, sou desu', vietnamese: 'V√¢ng, ƒë√∫ng v·∫≠y' },
            { japanese: '„ÅÑ„ÅÑ„Åà„ÄÅ„Å°„Åå„ÅÑ„Åæ„Åô', romaji: 'iie, chigaimasu', vietnamese: 'Kh√¥ng, kh√¥ng ph·∫£i' },
            { japanese: '„Åä„Å§„Åã„Çå„Åï„Åæ', romaji: 'otsukaresama', vietnamese: 'B·∫°n v·∫•t v·∫£ r·ªìi' },
            { japanese: '„Å©„ÅÜ„Åû„Çà„Çç„Åó„Åè', romaji: 'douzo yoroshiku', vietnamese: 'R·∫•t mong ƒë∆∞·ª£c gi√∫p ƒë·ª°' },
            { japanese: '„ÅÑ„Å£„Å¶„Åç„Åæ„Åô', romaji: 'ittekimasu', vietnamese: 'T√¥i ƒëi ƒë√¢y (s·∫Ω quay l·∫°i)' }
        ];

        let vocabulary = [...initialVocabulary];
        let availableWords = [];
        let totalWordsForQuiz = 0;
        let totalScore = 0;
        let wordScores = {}; // L∆∞u ƒëi·ªÉm cho m·ªói t·ª´
        let currentWord = null;
        
        // Load vocabulary from local storage
        function loadCustomVocabulary() {
            const customWords = JSON.parse(localStorage.getItem('customVocabulary')) || [];
            vocabulary = [...initialVocabulary, ...customWords];
        }

        // Save vocabulary to local storage
        function saveCustomVocabulary(newWord) {
            const customWords = JSON.parse(localStorage.getItem('customVocabulary')) || [];
            customWords.push(newWord);
            localStorage.setItem('customVocabulary', JSON.stringify(customWords));
            loadCustomVocabulary(); // Reload all words
        }
        
        // Save scores to local storage
        function saveScores() {
            localStorage.setItem('totalScore', JSON.stringify(totalScore));
            localStorage.setItem('wordScores', JSON.stringify(wordScores));
        }

        // Load scores from local storage
        function loadScores() {
            totalScore = JSON.parse(localStorage.getItem('totalScore')) || 0;
            wordScores = JSON.parse(localStorage.getItem('wordScores')) || {};
            scoreDisplay.textContent = totalScore;
        }

        // C√°c ph·∫ßn t·ª≠ DOM
        const homePage = document.getElementById('home-page');
        const quizPage = document.getElementById('quiz-page');
        const quizNavigation = document.getElementById('quiz-navigation');
        const addWordPage = document.getElementById('add-word-page');
        const fixedSizeQuizButtons = document.querySelectorAll('#home-page .option-button[data-quiz-size]');
        const addWordOptionButton = document.getElementById('add-word-option');
        const startCustomQuizButton = document.getElementById('start-custom-quiz');
        const customQuizInput = document.getElementById('custom-quiz-input');
        const backButton = document.getElementById('back-button');
        const japaneseWordEl = document.getElementById('japanese-word');
        const romajiEl = document.getElementById('romaji');
        const optionsContainer = document.getElementById('options-container');
        const nextButton = document.getElementById('next-button');
        const counterEl = document.getElementById('counter');
        const resultMessageEl = document.getElementById('result-message');
        const scoreDisplay = document.getElementById('score-display');
        const wordScoresBreakdown = document.getElementById('word-scores-breakdown');
        
        const japaneseInput = document.getElementById('japanese-input');
        const romajiInput = document.getElementById('romaji-input');
        const vietnameseInput = document.getElementById('vietnamese-input');
        const addButton = document.getElementById('add-button');
        const addMessage = document.getElementById('add-message');
        
        // H√†m x√°o tr·ªôn m·∫£ng
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // H√†m k·∫øt th√∫c b√†i tr·∫Øc nghi·ªám
        function endQuiz() {
            japaneseWordEl.textContent = 'Ho√†n th√†nh!';
            romajiEl.textContent = `B·∫°n ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra v·ªõi t·ªïng ƒëi·ªÉm: ${totalScore}`;
            optionsContainer.innerHTML = '';
            resultMessageEl.textContent = 'Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c c√¢u h·ªèi! üéâ';
            nextButton.classList.add('hidden');
            counterEl.textContent = '';
            
            // Hi·ªÉn th·ªã chi ti·∫øt ƒëi·ªÉm s·ªë c·ªßa t·ª´ng t·ª´
            wordScoresBreakdown.classList.remove('hidden');
            let scoresHtml = '<h3>Chi ti·∫øt ƒëi·ªÉm s·ªë:</h3>';
            const learnedWords = Object.keys(wordScores);
            if (learnedWords.length > 0) {
                learnedWords.forEach(word => {
                    // Find the total occurrences of this word in the quiz
                    const totalOccurrences = availableWords.filter(w => w.japanese === word).length;
                    scoresHtml += `<div class="score-item"><span>${word}</span> <span>${wordScores[word]} / ${totalOccurrences}</span></div>`;
                });
            } else {
                scoresHtml += '<p>Ch∆∞a c√≥ t·ª´ n√†o ƒë∆∞·ª£c tr·∫£ l·ªùi ƒë√∫ng.</p>';
            }
            wordScoresBreakdown.innerHTML = scoresHtml;
            
            saveScores(); // L∆∞u ƒëi·ªÉm s·ªë khi k·∫øt th√∫c quiz
        }

        // T·∫°o c√¢u h·ªèi v√† c√°c ƒë√°p √°n
        function generateQuestion() {
            wordScoresBreakdown.classList.add('hidden');
            
            // Check if all words have been used
            if (availableWords.length === 0) {
                endQuiz();
                return;
            }

            let nextWordIndex = Math.floor(Math.random() * availableWords.length);
            let nextWord = availableWords[nextWordIndex];
            
            // ƒê·∫£m b·∫£o t·ª´ m·ªõi kh√¥ng l·∫∑p l·∫°i t·ª´ v·ª´a r·ªìi
            if (currentWord && availableWords.length > 1) {
                while (nextWord.japanese === currentWord.japanese) {
                    nextWordIndex = Math.floor(Math.random() * availableWords.length);
                    nextWord = availableWords[nextWordIndex];
                }
            }

            currentWord = nextWord;
            availableWords.splice(nextWordIndex, 1);
            
            const correctAnswer = currentWord.vietnamese;

            const incorrectAnswers = [];
            const tempVocabulary = [...vocabulary].filter(word => word.japanese !== currentWord.japanese);
            shuffleArray(tempVocabulary);
            for (let i = 0; i < 3 && i < tempVocabulary.length; i++) {
                incorrectAnswers.push(tempVocabulary[i].vietnamese);
            }

            const allAnswers = [...incorrectAnswers, correctAnswer];
            shuffleArray(allAnswers);

            japaneseWordEl.textContent = currentWord.japanese;
            romajiEl.textContent = currentWord.romaji;
            optionsContainer.innerHTML = '';
            resultMessageEl.textContent = '';
            nextButton.classList.add('hidden');

            allAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer;
                button.classList.add('option-button');
                button.addEventListener('click', () => checkAnswer(button, answer, correctAnswer));
                optionsContainer.appendChild(button);
            });
            
            // Update counter
            counterEl.textContent = `${totalWordsForQuiz - availableWords.length}/${totalWordsForQuiz}`;
        }

        // Ki·ªÉm tra ƒë√°p √°n
        function checkAnswer(button, selectedAnswer, correctAnswer) {
            const allButtons = document.querySelectorAll('.option-button');
            allButtons.forEach(btn => btn.disabled = true);

            if (selectedAnswer === correctAnswer) {
                button.classList.add('correct');
                resultMessageEl.textContent = 'ƒê√∫ng r·ªìi!';
                totalScore++;
                scoreDisplay.textContent = totalScore;
                
                // Ghi ƒëi·ªÉm cho t·ª´ c·ª• th·ªÉ
                wordScores[currentWord.japanese] = (wordScores[currentWord.japanese] || 0) + 1;
                
                saveScores(); // L∆∞u ƒëi·ªÉm s·ªë ngay sau khi tr·∫£ l·ªùi ƒë√∫ng
                
                setTimeout(generateQuestion, 1000);
            } else {
                button.classList.add('incorrect');
                resultMessageEl.textContent = `Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${correctAnswer}`;
                const correctButton = Array.from(allButtons).find(btn => btn.textContent === correctAnswer);
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
                nextButton.classList.remove('hidden');
            }
        }

        // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c trang
        function showHomePage() {
            homePage.classList.remove('hidden');
            quizPage.classList.add('hidden');
            quizNavigation.classList.add('hidden');
            addWordPage.classList.add('hidden');
        }

        function showQuizPage() {
            homePage.classList.add('hidden');
            quizPage.classList.remove('hidden');
            quizNavigation.classList.remove('hidden');
            addWordPage.classList.add('hidden');
        }

        function showAddWordPage() {
            homePage.classList.add('hidden');
            quizPage.classList.add('hidden');
            quizNavigation.classList.remove('hidden');
            addWordPage.classList.remove('hidden');
            backButton.classList.remove('hidden'); // Ensure back button is visible
            nextButton.classList.add('hidden'); // Hide next button on this page
        }

        // Kh·ªüi t·∫°o m·ªôt b√†i quiz m·ªõi
        function startQuiz(quizSize) {
            totalWordsForQuiz = quizSize * 4; // M·ªói t·ª´ l·∫∑p l·∫°i 4 l·∫ßn
            
            shuffleArray(vocabulary);
            const selectedWords = vocabulary.slice(0, quizSize);
            
            availableWords = [];
            // Th√™m m·ªói t·ª´ v√†o m·∫£ng 4 l·∫ßn
            for (let i = 0; i < 4; i++) {
                availableWords.push(...selectedWords);
            }
            shuffleArray(availableWords);
            
            showQuizPage();
            generateQuestion();
        }

        // S·ª± ki·ªán khi nh·∫•n n√∫t tr√™n trang ch·ªß
        fixedSizeQuizButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const quizSize = parseInt(event.target.dataset.quizSize);
                if (!isNaN(quizSize)) {
                    startQuiz(quizSize);
                }
            });
        });

        // S·ª± ki·ªán khi nh·∫•n n√∫t "B·∫Øt ƒë·∫ßu" cho quiz t√πy ch·ªânh
        startCustomQuizButton.addEventListener('click', () => {
            const quizSize = parseInt(customQuizInput.value.trim());

            if (isNaN(quizSize) || quizSize <= 0 || quizSize > vocabulary.length) {
                resultMessageEl.textContent = `Vui l√≤ng nh·∫≠p m·ªôt s·ªë h·ª£p l·ªá t·ª´ 1 ƒë·∫øn ${vocabulary.length}.`;
                resultMessageEl.style.color = '#e74c3c';
                setTimeout(() => resultMessageEl.textContent = '', 3000);
                return;
            }
            startQuiz(quizSize);
        });
        
        // S·ª± ki·ªán khi nh·∫•n n√∫t "Th√™m t·ª´ m·ªõi"
        addWordOptionButton.addEventListener('click', showAddWordPage);

        // S·ª± ki·ªán khi nh·∫•n n√∫t "Th√™m t·ª´"
        addButton.addEventListener('click', () => {
            const japanese = japaneseInput.value.trim();
            const romaji = romajiInput.value.trim();
            const vietnamese = vietnameseInput.value.trim();

            if (japanese && romaji && vietnamese) {
                const newWord = { japanese, romaji, vietnamese };
                saveCustomVocabulary(newWord);
                addMessage.textContent = 'ƒê√£ th√™m t·ª´ th√†nh c√¥ng!';
                japaneseInput.value = '';
                romajiInput.value = '';
                vietnameseInput.value = '';
                
                // Clear message after a few seconds
                setTimeout(() => {
                    addMessage.textContent = '';
                }, 3000);
            } else {
                addMessage.textContent = 'Vui l√≤ng nh·∫≠p ƒë·ªß c√°c tr∆∞·ªùng.';
                addMessage.style.color = '#e74c3c';
            }
        });

        // S·ª± ki·ªán khi nh·∫•n n√∫t "Ti·∫øp theo"
        nextButton.addEventListener('click', generateQuestion);

        // S·ª± ki·ªán khi nh·∫•n n√∫t "Trang ch·ªß"
        backButton.addEventListener('click', () => {
            availableWords = [];
            totalWordsForQuiz = 0;
            currentWord = null;
            showHomePage();
            resultMessageEl.textContent = ''; // Clear result message when going back to home
        });
        
        // Load custom vocabulary and scores initially
        document.addEventListener('DOMContentLoaded', () => {
            loadCustomVocabulary();
            loadScores();
            showHomePage();
        });
    </script>

</body>
</html>
